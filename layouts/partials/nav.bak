{{ $currentNode := . }}
{{ range .Site.Menus.main.ByWeight }}
    {{ $.Scratch.Set "currentMenuEntry" . }}
    <li>
        {{ partial "nav_link" $currentNode }}
    </li>
{{ end }}

{{ if not .IsHome }}
  {{ if (isset .Params "version") }}
    {{ $section := replace .Section "-" "_" }}
    {{ $product_info := (index .Site.Params.products $section) }}
    {{ $version := .Params.version }}
    {{ if eq $version "latest" }}
      {{ $version := $product_info.latest }}
    {{ end }}
    {{ $sectionMenu := (index .Site.Menus ( printf "%s-%s" .Section $version )) }}
    <li>test</li>
    {{ range $sectionMenu }}
      {{ $.Scratch.Set "currentMenuEntry" . }}
        <li>
        {{ if .HasChildren }}
          <span class="section">{{ .Name | title }}</span>
          <ul>
            {{ range .Children }}
              {{ $.Scratch.Set "currentMenuEntry" . }}
              {{ partial "nav_link" $currentNode }}
            {{ end }}
            </ul>
        {{ else }}
          {{ partial "nav_link" $currentNode }}
        {{ end }}
      </li>
    {{ end }}
    
    {{ if (isset $product_info "submenus") }}
      {{ range $v := $product_info.submenus }}
        <li>{{ $v }}</li>
        {{ $subMenu := printf "%s-%s-%s" $.Section $version $v }}
        <li>{{ $subMenu }}</li>
          {{ range (index $.Site.Menus $subMenu) }}
            <li>{{ .Name }}</li>
          {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
