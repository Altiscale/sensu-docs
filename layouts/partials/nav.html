{{ $currentNode := . }}
{{ range .Site.Menus.main.ByWeight }}
    {{ $.Scratch.Set "currentMenuEntry" . }}
    <li class="nav-title">
      <a class="menu-title" href="/">Sensu Documentation Home</a>
    </li>
{{ end }}

{{ if not .IsHome }}
  {{ $section := replace .Section "-" "_" }}
  {{ $product_info := (index .Site.Params.products $section) }}
  {{ $.Scratch.Add "version" .Params.version }}
  {{ if (eq .Params.version "latest") }}
    {{ $.Scratch.Set "version" $product_info.latest }}
  {{ end }}
  {{ $version := $.Scratch.Get "version" }}
  <!-- loop through all menus, but only care if they're for our current section -->
  {{ range $k, $v := .Site.Menus }}
    {{ if and (ne $k "main") (in $k $.Section) }}
      <!-- special case for sensu enterprise dash -->
      {{ if not (and (in $k "sensu-enterprise-dashboard") (eq $.Section "sensu-enterprise")) }}
        <!-- check if we're looking at the section index, or a sub section -->
        {{ if (in $k $version) }}
          {{ $niceName := replace $k "-" " " }}
          {{ $niceName := title $niceName }}
          <!-- ex. Sensu Core 1.0 -->
          <li><a class="menu-title">{{ $niceName }}</a><ul class="panel">
          <!-- Loop through the menus pages -->
          {{ range $y, $x := $v }}
            <!-- if the menu has a child menu -->
            {{ if .HasChildren }}
              {{ if (in $k $version) }}
                {{ $niceName := replace $x.Name "-" " " }}
                {{ $niceName := title $niceName }}
                <!-- saving the menu as API breaks it in the front matter, so we need to format it here -->
                {{ if or (eq $niceName "Api") (eq $niceName "Rbac") }}
                  {{ $niceName := upper $niceName }}
                  <li><a class="menu-title accordion">{{ $niceName }}<span class="menu-dropdown-icon"><i class="fa fa-chevron-down" aria-hidden="true"></i></span></a>
                <!-- render the title normally if not API -->
                {{ else }}
                  <li><a class="menu-title accordion">{{ $niceName }}<span class="menu-dropdown-icon"><i class="fa fa-chevron-down" aria-hidden="true"></i></span></a>
                {{ end }}
                <ul class="panel">
                  <!-- Loop through the child menu's pages -->
                  {{ range .Children.ByWeight }}
                    {{ if not (eq (lower .Parent) (lower .Name)) }}
                      <li><a class="menu-child" href="/{{ .URL | absURL }}">{{ .Name }}</a></li>
                    {{ end }}
                  {{ end }}
                </ul>
              {{ end }}
            <!-- No children, render page normally -->
            {{ else }}
              <li><a class="menu-child" href="/{{ .URL | absURL }}">{{ $x.Name }}</a>
            {{ end }}
            </li>
          {{ end }}
          </ul></li>
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}


<script>
var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
    acc[i].onclick = function(){
        /* Toggle between adding and removing the "active" class,
        to highlight the button that controls the panel */
        this.classList.toggle("active");

        /* Toggle between hiding and showing the active panel */
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            panel.style.display = "block";
        }
    }
}
</script>
