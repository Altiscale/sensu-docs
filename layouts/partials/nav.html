{{ $currentNode := . }}
{{ range .Site.Menus.main.ByWeight }}
    {{ $.Scratch.Set "currentMenuEntry" . }}
    <li>
        {{ partial "nav_link" $currentNode }}
    </li>
{{ end }}

{{ if not .IsHome }}
  {{ $section := replace .Section "-" "_" }}
  {{ $product_info := (index .Site.Params.products $section) }}
  {{ $.Scratch.Add "version" .Params.version }}
  {{ if (eq .Params.version "latest") }}
    {{ $.Scratch.Set "version" $product_info.latest }}
  {{ end }}
  {{ $version := $.Scratch.Get "version" }}
  {{ range $k, $v := .Site.Menus }}
    {{ if and (ne $k "main") (in $k $.Section) }}
        {{ if (in $k $version) }}
          {{ $niceName := replace $k "-" " " }}
          {{ $niceName := title $niceName }}
          <li><span style="font-size: 16px;"><a href="/{{ $.Section }}/{{ $version }}">{{ $niceName }}</a></span><ul>
        {{ else }}
          {{ $niceName := replace $k "-" " " }}
          {{ $niceName := title $niceName }}
          <li><span style="font-size: 16px;"><a href="/{{ $.Section }}">{{ $niceName }}</a></span><ul>
        {{ end }}
        {{ range $y, $x := $v }}
          {{ $formattedName := urlize $x.Name }}
          {{ if .HasChildren }}
            {{ if (in $k $version) }}
              {{ $niceName := replace $x.Name "-" " " }}
              {{ $niceName := title $niceName }}
              {{ if $niceName := "Api" }}
                {{ $niceName := upper $niceName }}
                <li><span style="font-size: 16px;"><a href="/{{ $.Section }}/{{ $version }}/{{ $formattedName }}">{{ $niceName }}</a></span>
              {{ else }}
                <li><span style="font-size: 16px;"><a href="/{{ $.Section }}/{{ $version }}/{{ $formattedName }}">{{ $niceName }}</a></span>
              {{ end }}
                <ul>
                  {{ range .Children }}
                    {{ $childName := urlize .Name }}
                    <li><a href="/{{ $.Section }}/{{ $version }}/{{ $formattedName }}/{{ $childName }}">{{ .Name }}</a></li>
                  {{ end }}
                </ul>
            {{ else }}
              <li><span style="font-size: 16px;"><a href="/{{ $.Section }}/{{ $formattedName }}">{{ $x.Name }}</a></span>
                <ul>
                  {{ range .Children }}
                    {{ $child := urlize . }}
                    {{ $childName := urlize .Name }}
                    <li><a href="/{{ $.Section }}/{{ $child }}">{{ .Name }}</a></li>
                  {{ end }}
                </ul>
              {{ end }}
          {{ else }}
            {{ $niceName := replace $x.Name "-" " " }}
            {{ $niceName := title $niceName }}
            <li><a href="/{{ $.Section }}/{{ $version }}/{{ $formattedName }}">{{ $niceName }}</a>
          {{ end }}
          </li>
        {{ end }}
      </ul></li>
    {{ end }}
  {{ end }}
{{ end }}
