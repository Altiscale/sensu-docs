{{ $color := index . 0 }}
{{ $message := index . 1 }}
{{ $link := index . 2 }}

<!-- creates a "mostly" unique id if there's multiple alerts -->
{{ $uniqueness := replace $message " " "" }}

<div class="alertBanner" id="{{ $uniqueness }}" style="background-color: {{ $color }}">
  {{ if $link }}
    <a class="alertBannerText" href="{{ $link }}">{{ $message }}</a>
    <span class="closeAlert"><i class="fa fa-times" aria-hidden="true" onClick="closeAlert({{ $uniqueness }})"></i></span>
  {{ else }}
    <span class="alertBannerText">{{ $message }}</span>
    <span class="closeAlert"><i class="fa fa-times" aria-hidden="true" onClick="closeAlert({{ $uniqueness }})"></i></span>
  {{ end }}
</div>

<script>
  alerts = Array.prototype.slice.call(document.getElementsByClassName("alertBanner"));
  currentBanner = $(document.getElementById({{ $uniqueness }}));

  // stack the alerts as needed
  for (i = 1; i <= alerts.length; i++) {
    lastLocation = parseInt($(alerts[i]).css('top'), 10);
    height = 28;
    newLocation = lastLocation + height;
    currentBanner.css('top', newLocation + "px");
    // double incrementing is a little weird, but we get gaps otherwise
    i++;
  };

  function closeAlert(id) {
    // grab information before delete
    alerts = Array.prototype.slice.call(document.getElementsByClassName("alertBanner"));
    currentBanner = $(document.getElementById(id));
    arrLocation = alerts.findIndex(alert => alert.id == currentBanner[0].id);
    lastLocation = parseInt(currentBanner.css('top'), 10);
    document.getElementById(id).remove();

    // unstack the alerts as needed
    for (i = arrLocation + 1; i <= alerts.length; i++){
      height = 28;
      (i == arrLocation + 1) ? newLocation = lastLocation : newLocation = lastLocation + height;
      lastLocation = newLocation;
      console.log(i);
      $(alerts[i]).css('top', newLocation + "px");
    };
  }
</script>
